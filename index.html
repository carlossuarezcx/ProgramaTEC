<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vehículo</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            height: 100vh;
            margin: 0;
        }

        .controles {
            flex: 65;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(3, 110px);
            grid-template-rows: repeat(3, 110px);
            gap: 2px;
            justify-content: center;
            align-items: center;
        }

        .acciones {
            flex: 10;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .acciones-container {
            display: grid;
            grid-template-columns: repeat(2, 110px);
            gap: 10px;
            justify-content: center;
            align-items: center;
        }

        .steps {
            flex: 25;
            display: flex;
            align-items: center;
            overflow-x: auto;
            gap: 10px;
            background-color: #f0f0f0;
            padding: 10px;
        }

        button {
            background: none;
            border: none;
            padding: 0;
            cursor: pointer;
            outline: none;
        }

        .pressed img {
            transform: scale(0.9);
            transition: transform 0.1s;
        }

        img {
            max-width: 100%;
            max-height: 100%;
            transition: transform 0.1s;
        }

        .steps img {
            width: 8%;
            height: auto;
        }

        .highlight {
            filter: drop-shadow(0 0 0.75rem crimson);
            transition: filter 3s;
        }
    </style>
</head>

<body>
    <div class="controles">
        <div class="grid-container">
            <div class="grid-item empty"></div>
            <div class="grid-item">
                <button onclick="accion('adelante', this)" onmousedown="presionar(this)" onmouseup="soltar(this)">
                    <img src="img/adelante.png" alt="Adelante">
                </button>
            </div>
            <div class="grid-item empty"></div>

            <div class="grid-item">
                <button onclick="accion('izquierda', this)" onmousedown="presionar(this)" onmouseup="soltar(this)">
                    <img src="img/izquierda.png" alt="Izquierda">
                </button>
            </div>
            <div class="grid-item empty"></div>
            <div class="grid-item">
                <button onclick="accion('derecha', this)" onmousedown="presionar(this)" onmouseup="soltar(this)">
                    <img src="img/derecha.png" alt="Derecha">
                </button>
            </div>

            <div class="grid-item empty"></div>
            <div class="grid-item">
                <button onclick="accion('atras', this)" onmousedown="presionar(this)" onmouseup="soltar(this)">
                    <img src="img/atras.png" alt="Atrás">
                </button>
            </div>
            <div class="grid-item empty"></div>
        </div>
    </div>
    <div class="acciones" id="acciones">
        <div class="acciones-container">
            <div class="grid-item">
                <button onclick="stop(this)" onmousedown="presionar(this)" onmouseup="soltar(this)">
                    <img src="img/stop.png" alt="Stop">
                </button>
            </div>
            <div class="grid-item">
                <button onclick="play(this)" onmousedown="presionar(this)" onmouseup="soltar(this)">
                    <img src="img/play.png" alt="Play">
                </button>
            </div>
        </div>
    </div>
    <div class="steps" id="stepsContainer">
    </div>

    <script>
        let cadenaAcciones = ""
        let interval;
        function accion(direccion, button) {
            const stepsContainer = document.getElementById('stepsContainer');
            const img = document.createElement('img');
            img.src = `img/${direccion}.png`;
            img.alt = direccion.charAt(0).toUpperCase() + direccion.slice(1);
            stepsContainer.appendChild(img);

            if (direccion == 'adelante')
                cadenaAcciones += 'W'
            else if (direccion == 'atras')
                cadenaAcciones += 'S'
            else if (direccion == 'izquierda')
                cadenaAcciones += 'A'
            else if (direccion == 'derecha')
                cadenaAcciones += 'D'
        }

        function presionar(button) {
            button.classList.add('pressed');
        }

        function soltar(button) {
            button.classList.remove('pressed');
        }
        function stop() {
            if (interval) {
                clearInterval(interval);
            }
            cadenaAcciones = ""
            const stepsContainer = document.getElementById('stepsContainer');
            while (stepsContainer.firstChild) {
                stepsContainer.removeChild(stepsContainer.firstChild);
            }
        }
        async function play() {
            //alert("La secuencia de acciones: " + cadenaAcciones)
            if (interval)
                clearInterval(interval);

            const images = stepsContainer.getElementsByTagName('img');
            for (let i = 0; i < images.length; i++) {
                images[i].classList.remove('highlight');
            }

            cadenaAcciones = "";
            let index = 0;
            const intervalTime = 2000;

            if (images.length > 0) {
                images[index].classList.add('highlight');
                index++
            }

            interval = setInterval(() => {
                if (index < images.length) {
                    images[index].classList.add('highlight');
                    index++;
                } else {
                    clearInterval(interval);
                }
            }, intervalTime);

            try {
                const request = new Request("https://192.168.31.17/secuencia", {
                    headers: {
                        "Content-Type": "text/plain"
                    },
                    method: "POST",
                    body: cadenaAcciones,
                });

                const response = await fetch(request);
                const responseText = await response.text();
                alert(responseText);
            } catch (error) {
                console.error("Error al realizar la solicitud:", error);
                alert("Ocurrió un error al realizar la solicitud");
            }
        }
    </script>
</body>

</html>